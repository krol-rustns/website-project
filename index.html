<!DOCTYPE html>
<html lang="pt-BR">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Consórcios LTDA</title>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
        <style>
            .modalBackdrop{
                position:fixed;
                top:0;
                left:0;
                width:100vw;
                height:100vh;
                background-color:rgba(0,0,0,0.2);
                backdrop-filter: blur(5px);
            }
            .row {
                display: flex;
                justify-content: space-between;
                margin: 10px 20px;
            }
            body {
                background-color: #3f3d3d;
                color: #ffffff;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            }
            .table {
                color: #ffffff;
            }
            .btn {
                background-color: cadetblue;
                border-color: cadetblue;
            }
            .btn:hover {
                background-color: rgb(54, 85, 86);
                border-color: cadetblue;
            }
            .btn:focus {
                -moz-box-shadow: none !important;
                -webkit-box-shadow: none !important;
                box-shadow: none !important;
            }
            .modal {
                color: #3f3d3d;
            }
            .form-control-margin{
                margin-bottom: 0;
            }
            input, textarea, button{
                padding: 8px 15px;
                border-radius: 5px !important;
                margin: 5px 0px;
                box-sizing: border-box;
                border: 1px solid #ccc;
                font-size: 18px !important;
                font-weight: 300
            }
            #cargo{
                padding: 8px 15px;
                border-radius: 5px !important;
                margin: 5px 0px;
                box-sizing: border-box;
                border: 1px solid #ccc;
                font-size: 18px !important;
                font-weight: 300
            }
            input:focus, textarea:focus{
                -moz-box-shadow: none !important;
                -webkit-box-shadow: none !important;
                box-shadow: none !important;
                border: 1px solid #00BCD4;
                outline-width: 0;
                font-weight: 400
            }
            #cargo:focus{
                -moz-box-shadow: none !important;
                -webkit-box-shadow: none !important;
                box-shadow: none !important;
                border: 1px solid #00BCD4;
                outline-width: 0;
                font-weight: 400
            }
            .headerList {
                display: flex;
                align-items: center;
                justify-content: space-between;
            }
            .headerList h3 {
                margin: 0;
            }
            
        </style>
    </head>
    <body>
        <div class="container m-auto" style="padding-top: 25px;">
            <div class="headerList">
                <h3>Vendas</h3>
                <span>
                    <button id="btnAdd" type="button" class="btn btn-primary">+ Adicionar</button>
                    <a href="C:\Users\nilva.costa.AGU\Downloads\webiste\relatorioVendas.html" target="_blank"><button id="btnGerar" type="button" class="btn btn-primary">Gerar relatório</button></a>
                </span>
            </div>

            <table class="table table-hover">
                <thead>
                    <tr class="text-center">
                        <th class="col-2 text-center">Código do Vendedor</th>
                        <th class="col-4 text-center">Nome do Vendedor</th>
                        <th class="col-2">Cargo do Vendedor</th>
                        <th class="col-2">Código da Venda</th>
                        <th class="col-3 text-center">Valor da Venda</th>
                    </tr>

                </thead>
                <tbody class="corpo"></tbody>
            </table>
        </div>

        <div class="modalBackdrop hidden" style="display: none;"></div>
        <div id="modalAdicionarContato" class="modal">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Adicionar Nova Venda</h5>
                        <button type="button" class="close" id="closeModal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="addVendedor">
                            <div class="form-group">
                                <label for="codigoVendedor">Código do Vendedor:</label>
                                <input type="number" class="form-control" id="codigoVendedor" required>
                            </div>
                            <div class="form-group">
                                <label for="nome">Nome:</label>
                                <input type="text" class="form-control" id="nome" required>
                            </div>
                            <div class="form-row">
                                <div class="form-group col-md-4">
                                    <label for="cargo">Cargo:</label>
                                    <select class="form-control" id="cargo" required>
                                      <option>Júnior</option>
                                      <option>Pleno</option>
                                      <option>Sênior</option>
                                    </select>
                                  </div>
                                <div class="form-group col-md-4">
                                    <label for="codigoVenda">Código da Venda:</label>
                                    <input type="number" class="form-control" id="codigoVenda" required>
                                </div>
                                <div class="form-group col-md-4">
                                    <label for="valorVenda">Valor da Venda:</label>
                                    <input type="number" class="form-control" id="valorVenda" step="any" required>
                                </div>
                            </div>
                            <hr />
                            <button type="submit" class="btn btn-primary">Salvar Contato</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <script>
            let vendedores = [];

            const abrirModal = document.getElementById("modalAdicionarContato");
            const addVenda = document.getElementById("btnAdd");
            const backOpacity = document.getElementsByClassName("modalBackdrop")[0];

            addVenda.addEventListener('click', function(){
                abrirModal.style.display = 'block';
                backOpacity.style.display = 'block';
                
            })

            document.getElementById("closeModal").addEventListener('click', function(){
                abrirModal.style.display = 'none';
                backOpacity.style.display = 'none';
            })

            window.onclick = function(event){
                if(event.target === abrirModal) {
                    abrirModal.style.display = 'none';
                    backOpacity.style.display = 'none';
                }
            }

            document.getElementById("addVendedor").addEventListener('submit', function(event){
                event.preventDefault();

                let codigoVendedor = document.getElementById("codigoVendedor").value;
                let nome = document.getElementById("nome").value;
                let cargo = document.getElementById("cargo").value;
                let codigoVenda = document.getElementById("codigoVenda").value;
                let valorVenda = document.getElementById("valorVenda").value;

                const vendedor = {
                    codigoVendedor,
                    nome,
                    cargo,
                    codigoVenda,
                    valorVenda
                };

                vendedores.push(vendedor);
                renderizarTabela();
                document.getElementById("addVendedor").reset();
                abrirModal.style.display = 'none';
                backOpacity.style.display = 'none';
            })

            function renderizarTabela(){
                let tabela = document.querySelector('.table tbody');
                tabela.innerHTML = '';

                for(let vendedor of vendedores){
                    let codigoVendedorSemZero = parseInt(vendedor.codigoVendedor, 10);
                    let codigoVendaSemZero = parseInt(vendedor.codigoVenda, 10);
                    let codigoVendedorFormatado = formatarCodigo(codigoVendedorSemZero);
                    let codigoVendaFormatado = formatarCodigo(codigoVendaSemZero);
                    let valorVendaFormatado = formatarValor(vendedor.valorVenda);
                    let nomeFormatado = capitalizarPrimeiraLetra(vendedor.nome);

                    let novaLinha = `
                                    <tr class="text-center">
                                        <td class="col-1 text-center">${codigoVendedorFormatado}</td>
                                        <td class="col-3 text-center">${nomeFormatado}</td>
                                        <td class="col-1">${vendedor.cargo}</td>
                                        <td class="col-1">${codigoVendaFormatado}</td>
                                        <td class="col-3 text-center">${valorVendaFormatado}</td>
                                    </tr>`;
                    tabela.innerHTML += novaLinha;
                }

            }

            function formatarCodigo(codigo){
                //return codigo < 10 ? `00${codigo}` : `0${codigo}`;
                return codigo < 100 ? (codigo < 10 ? `00${codigo}` : `0${codigo}`) : `${codigo}`;
            }
            
            function formatarValor(valor){
                valor = parseFloat(valor);
                const valorVendaFormatada = `R$${valor.toLocaleString('pt-BR', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                })}`;

                return valorVendaFormatada;
            }

            // Função para capitalizar a primeira letra de uma string
            function capitalizarPrimeiraLetra(string) {
                return string.charAt(0).toUpperCase() + string.slice(1);
            }


            document.addEventListener('DOMContentLoaded', function(){
                fetch(`http://localhost:5000/vendedores`)
                    .then(response => response.json())
                    .then(data => {
                        vendedores = data;
                        renderizarTabela();
                    })
                    .catch(error => console.error('Error:', error));
            });

        </script>
    </body>
</html>